<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Nearest Widget</title>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">

        <!-- Optional theme -->
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">

        <!-- ESRI CSS -->
        <link rel="stylesheet" type="text/css" href="//js.arcgis.com/3.11/esri/css/esri.css" />
        
        <!-- Nearest CSS -->
        <link rel="stylesheet" type="text/css" href="js/resources/Nearest.css" />
        <link rel="stylesheet" type="text/css" href="js/resources/NearestLayer.css" />
        <link rel="stylesheet" type="text/css" href="js/resources/NearestItem.css" />



        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script>
            var package_path = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/'));
            var dojoConfig = {
                async: true,
                has: { "native-xhr2": false },
                packages: [{
                    name: "app",
                    location: package_path + '/js'
                }]
            };
        </script>

        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

        <!-- Latest compiled and minified JavaScript -->
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

        <script src="//js.arcgis.com/3.11/"></script>

        <script type="text/javascript">
            require([
                "esri/geometry/Point", "esri/SpatialReference", "app/Nearest", "esri/map", "dojo/topic", "esri/InfoTemplate", "esri/symbols/SimpleFillSymbol",
                "esri/symbols/SimpleLineSymbol", "esri/Color", "esri/symbols/SimpleMarkerSymbol", "esri/symbols/CartographicLineSymbol", "esri/symbols/PictureFillSymbol", "esri/graphic"],
                function (Point, SpatialReference, Nearest, Map, topic, InfoTemplate, SimpleFillSymbol, SimpleLineSymbol, Color, SimpleMarkerSymbol, CartographicLineSymbol, PictureFillSymbol, Graphic) {
                var nearest = new Nearest({
                    webmapId: "0713c71403f94013a399ab54910ec8bf",
                    location: new Point("-0.8055515", "51.8003171", new SpatialReference({ wkid: 4326 })),
                    searchRadius: 50,
                    layerOptions: [
                        {
                            itemId: "fe37166bf13143d19a91d6e9bf96c8c5",
                            searchRadius: 50,
                            maxResults: 5,
                            showOnMap: false
                        },
                        {
                            itemId: "7b9ddd9e54f5410eafbe9e3fc0ad8910",
                            searchRadius: 50,
                            maxResults: 3,
                            showOnMap: true
                        },
                        {
                            itemId: "ee34ad1a6d7a4069a4d65e4927528dd7",
                            searchRadius: 50,
                            maxResults: 1,
                            showOnMap: false
                        }
                    ]
                }, "nearestWidget");
                    
                nearest.startup();

                var nearestSingle = new Nearest({
                    webmapId: "a33fdad34af2419dbdb378e156c333f2",
                    location: new Point("-0.8055515", "51.8003171", new SpatialReference({ wkid: 4326 })),
                    searchRadius: 1,
                    maxResults: 1,
                    display: "fixed"
                }, "singleNearest");

                nearestSingle.startup();

                map = new Map("map", {
                    center: [-0.8055515, 51.8003171],
                    zoom: 3,
                    basemap: "topo"
                });

                topic.subscribe("Nearest::showonmap", function (feature) {
                    var infoTemplate = new InfoTemplate();

                    var markerSymbol = new SimpleMarkerSymbol();
                    markerSymbol.setPath("M16,4.938c-7.732,0-14,4.701-14,10.5c0,1.981,0.741,3.833,2.016,5.414L2,25.272l5.613-1.44c2.339,1.316,5.237,2.106,8.387,2.106c7.732,0,14-4.701,14-10.5S23.732,4.938,16,4.938zM16.868,21.375h-1.969v-1.889h1.969V21.375zM16.772,18.094h-1.777l-0.176-8.083h2.113L16.772,18.094z");
                    markerSymbol.setColor(new Color("#00FFFF"));

                    // lineSymbol used for freehand polyline, polyline and line. 
                    var lineSymbol = new CartographicLineSymbol(
                      CartographicLineSymbol.STYLE_SOLID,
                      new Color([255, 0, 0]), 10,
                      CartographicLineSymbol.CAP_ROUND,
                      CartographicLineSymbol.JOIN_MITER, 5
                    );

                    // fill symbol used for extent, polygon and freehand polygon, use a picture fill symbol
                    // the images folder contains additional fill images, other options: sand.png, swamp.png or stiple.png
                    var fillSymbol = new PictureFillSymbol(
                      "images/mangrove.png",
                      new SimpleLineSymbol(
                        SimpleLineSymbol.STYLE_SOLID,
                        new Color('#000'),
                        1
                      ),
                      42,
                      42
                    );

                    // figure out which symbol to use
                    var symbol;
                    if (feature.feature.geometry.type === "point" || feature.feature.geometry.type === "multipoint") {
                        symbol = markerSymbol;
                    } else if (feature.feature.geometry.type === "line" || feature.feature.geometry.type === "polyline") {
                        symbol = lineSymbol;
                    }
                    else {
                        symbol = fillSymbol;
                    }

                    //feature.setSymbol(symbol);
                    //feature.setInfoTemplate(infoTemplate);

                    map.graphics.add(new Graphic(feature.feature.geometry, symbol));
                });
            });

        </script>
    </head>
    <body class="claro">
        <div class="container">

            <!-- Jumbotron -->
            <div class="jumbotron">
                <h1>Nearest Widget</h1>
                <p class="lead">Some examples of using the Nearest widget with Bootstrap CSS for style.</p>
            </div>

            <!-- Example row of columns -->
            <div class="row">
                <div class="col-lg-7">
                    <h2>A map</h2>
                    <div id="map"></div>
                </div>

                <div class="col-lg-5">
                    <h2>Single layer</h2>
                    <div id="singleNearest"></div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <h2>List with 3 layers</h2>
                    <div id="nearestWidget"></div>
                </div>
            </div>

            <!-- Site footer -->
            <footer class="footer">
                <p>&copy; Company 2014</p>
            </footer>

        </div>
        <!-- /container -->

        
    </body>
</html>
